# 🎬 改进版可视化演示 - 使用指南

## 📂 如何打开HTML文件

### 方法1: 使用浏览器直接打开（推荐）

#### Linux:
```bash
# Firefox
firefox results/attack_demo_improved.html

# Chrome/Chromium
google-chrome results/attack_demo_improved.html
chromium-browser results/attack_demo_improved.html

# 或使用系统默认浏览器
xdg-open results/attack_demo_improved.html
```

#### macOS:
```bash
# Safari/默认浏览器
open results/attack_demo_improved.html

# Chrome
open -a "Google Chrome" results/attack_demo_improved.html

# Firefox  
open -a Firefox results/attack_demo_improved.html
```

#### Windows:
```bash
# 在文件资源管理器中双击HTML文件
# 或者在命令行中:
start results/attack_demo_improved.html
```

### 方法2: 使用VS Code/Cursor
1. 右键点击HTML文件
2. 选择 "Open with Live Server" 或 "Open in Default Browser"

### 方法3: 启动本地服务器（如果上述方法有跨域问题）
```bash
# Python 3
cd results
python3 -m http.server 8000

# 然后在浏览器访问:
# http://localhost:8000/attack_demo_improved.html
```

## ✅ 主要改进

### 1. 新布局设计
```
┌─────────────────────────────────────────────────────────┐
│  Header: 标题和说明                                      │
├──────────────────────┬──────────────────────────────────┤
│  左侧 (60%)          │  右侧 (40%)                       │
│                      │                                   │
│  ┌─原始图─────────┐  │  ┌─选择攻击阶段──────────────┐   │
│  │                │  │  │ ○ 身份去匿名化            │   │
│  │   图1 (上)     │  │  │ ○ 属性推断                │   │
│  │                │  │  │ ○ 鲁棒性                  │   │
│  └────────────────┘  │  │ ○ 防御                    │   │
│                      │  └──────────────────────────────┘   │
│  ┌─匿名图/修改图──┐  │  ┌─选择演示方法──────────────┐   │
│  │                │  │  │ ○ 贪心匹配                │   │
│  │   图2 (下)     │  │  │ ○ 匈牙利算法              │   │
│  │                │  │  │ ○ 图核方法                │   │
│  └────────────────┘  │  └──────────────────────────────┘   │
│                      │                                   │
│                      │  [算法说明]                       │
│                      │  [演示步骤]                       │
│                      │  [统计信息]                       │
│                      │  [▶️开始] [⏭️下一步] [🔄重置]    │
└──────────────────────┴──────────────────────────────────┘
```

### 2. 停止自动刷新
- ✅ 图形在3秒后自动停止力导向布局计算
- ✅ 节点位置固定，不会再"漂移"
- ✅ 拖动节点不会触发全图重新布局
- ✅ 用户操作不会被刷新打断

### 3. 增量显示边的变化

#### 鲁棒性测试（边缺失）
- **原理**: 逐步移除边，不是整图替换
- **显示**: 
  - 被移除的边显示为**红色虚线**
  - 每一步只添加新移除的边标记
  - 累积显示所有被移除的边

```
步骤1 (缺失10%):
  → 移除27条边（红色虚线）
  
步骤2 (缺失20%):  
  → 再移除27条边（新增红色虚线）
  → 累计移除54条边
  
步骤3 (缺失30%):
  → 再移除27条边
  → 累计移除81条边
```

#### 防御机制（添加噪声边）
- **原理**: 逐步添加噪声边，不是整图替换
- **显示**:
  - 新添加的边显示为**绿色高亮**
  - 每一步只添加新的噪声边
  - 累积显示所有噪声边

```
步骤1 (ε=0.5, 强隐私):
  → 添加27条噪声边（绿色）
  
步骤2 (ε=1.0, 中等):
  → 再添加13条噪声边（绿色）
  → 累计添加40条噪声边
  
步骤3 (ε=2.0, 弱隐私):
  → 再添加7条噪声边
  → 累计添加47条噪声边
```

## 🎮 使用流程

### 基本操作

1. **选择攻击阶段**
   - 点击右侧顶部的4个大按钮
   - 活跃的按钮会显示为紫色

2. **选择具体方法**
   - 在"选择演示方法"区域选择
   - 活跃的方法会显示为蓝色高亮

3. **查看说明**
   - 算法说明会显示在黄色框中
   - 包含方法名称和详细描述

4. **开始演示**
   - 点击 **▶️ 开始** - 自动播放所有步骤
   - 点击 **⏭️ 下一步** - 手动执行下一步
   - 点击 **🔄 重置** - 回到初始状态

5. **观察变化**
   - 左侧图形会高亮相关节点
   - 右侧显示当前执行的步骤
   - 统计数据实时更新

### 图形交互

- **拖动节点**: 点击并拖动任意节点调整位置
- **缩放视图**: 使用鼠标滚轮放大/缩小
- **平移视图**: 按住空白区域拖动
- **查看详情**: 鼠标悬停在节点上

## 📊 各阶段演示说明

### 阶段1: 身份去匿名化

**可视化内容:**
- 上图: 原始图
- 下图: 匿名图
- 高亮: 正在匹配的节点和候选节点

**观察要点:**
- 红色节点 = 当前正在匹配的原始图节点
- 黄色节点 = 匿名图中的候选匹配节点
- 绿色节点 = 确认匹配成功的节点

**统计信息:**
- 节点总数
- 匹配对数
- 正确匹配数
- 准确率

### 阶段2: 属性推断

**可视化内容:**
- 上图: 已知标签节点（彩色）
- 下图: 标签传播过程
- 颜色: 不同标签用不同颜色表示

**观察要点:**
- 彩色节点 = 已知标签
- 灰色节点 = 未知标签（待推断）
- 节点颜色变化 = 标签被成功推断

**邻居投票方法:**
- 显示每个节点的邻居投票结果
- 投票统计（每个标签的票数）

**标签传播方法:**
- 显示每次迭代更新的节点
- 迭代次数和收敛情况

### 阶段3: 鲁棒性测试

**可视化内容:**
- 上图: 原始完整图（固定）
- 下图: 逐步移除边

**观察要点:**
- ⚠️ **重点**: 下图从完整图开始，**增量显示**移除的边
- 红色虚线 = 被移除的边
- 每步新增的虚线 = 本次移除的边
- 观察图的连通性变化

**步骤说明:**
```
步骤1: 缺失10% → 本次移除27条边
步骤2: 缺失20% → 再移除27条边（累计54条）
步骤3: 缺失30% → 再移除27条边（累计81条）
...
```

### 阶段4: 防御机制

**可视化内容:**
- 上图: 原始图（固定）
- 下图: 逐步添加噪声边

**观察要点:**
- ⚠️ **重点**: 下图从原始图开始，**增量显示**添加的噪声边
- 绿色边 = 新添加的噪声边
- 每步新增的绿色边 = 本次添加的噪声
- 观察图的结构变化

**隐私强度:**
- ε=0.5: 强隐私保护（添加最多噪声）
- ε=1.0: 中等保护
- ε=2.0: 弱保护
- ε=5.0: 最小保护

**步骤说明:**
```
步骤1: ε=0.5 → 添加27条噪声边（绿色）
步骤2: ε=1.0 → 再添加13条噪声边（累计40条）
步骤3: ε=2.0 → 再添加7条噪声边（累计47条）
...
```

## 💡 常见问题

### Q1: 图还是在动？
**A**: 等待3秒，布局算法会自动停止。如果还在动，可能是你拖动了节点。

### Q2: 鲁棒性/防御阶段看不出边的变化？
**A**: 
- 确保使用改进版 (`attack_demo_improved.html`)
- 点击"下一步"逐步观察
- 红色虚线=移除的边，绿色=添加的边
- 可以缩放图形查看细节

### Q3: 点击"开始"后步骤太快？
**A**: 可以使用"下一步"按钮手动控制进度。

### Q4: 想调整演示速度？
**A**: 在HTML文件中找到以下代码（约3300行）:
```javascript
playInterval = setInterval(() => {
    if (currentStep >= document.querySelectorAll('.step').length) {
        stopAnimation();
    } else {
        nextStep();
    }
}, 2000);  // ← 修改这里，单位是毫秒
```
改成 `3000` 会更慢，改成 `1000` 会更快。

### Q5: 浏览器显示空白或报错？
**A**: 
1. 确保使用现代浏览器（Chrome 90+, Firefox 88+, Edge 90+）
2. 打开浏览器控制台（F12）查看错误信息
3. 确保D3.js能正常加载（需要网络连接）

### Q6: 想用更大的网络？
**A**: 
```bash
python visualize_attack_principles_v2.py --ego_id 0
```
但要注意大网络可能导致浏览器卡顿。

## 🎯 对比版本

| 功能 | 原版 | 改进版 |
|------|------|--------|
| 布局 | 左右两图 | 上下两图+右侧控制面板 |
| 自动刷新 | 一直刷新 | 3秒后停止 ✅ |
| 边的显示 | 整图替换 | 增量显示 ✅ |
| 鲁棒性 | 看不出变化 | 红色虚线显示移除 ✅ |
| 防御 | 看不出变化 | 绿色高亮显示添加 ✅ |
| 用户体验 | 操作被打断 | 稳定流畅 ✅ |

## 📁 文件路径

- **改进版**: `results/attack_demo_improved.html`
- **原版**: `results/attack_principles_demo.html`

## 🚀 快速开始

```bash
# 生成改进版演示
python visualize_attack_principles_v2.py --ego_id 698

# 在浏览器中打开
firefox results/attack_demo_improved.html

# 开始使用：
# 1. 选择"阶段3:鲁棒性测试"
# 2. 点击"开始"
# 3. 观察红色虚线逐步出现（被移除的边）
```

---

**🎉 享受改进的演示体验！**

如有任何问题，请查阅完整文档或联系开发者。









