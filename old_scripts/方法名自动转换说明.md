# 🔄 方法名自动转换功能说明

## ✅ 功能概述

**问题**：旧的JSON结果文件包含 `Baseline-Greedy` 方法名

**解决方案**：在可视化代码中添加自动转换功能，实现向后兼容

---

## 🎯 实现方式

### 1. 自动转换逻辑

在 `UnifiedAutoVisualizer` 类的初始化中添加了 `_normalize_method_names()` 方法：

```python
def _normalize_method_names(self):
    """标准化方法名称，处理向后兼容性"""
    # 方法名映射表
    name_mapping = {
        'Baseline-Greedy': 'Greedy',
        'Baseline Greedy': 'Greedy',
        'baseline-greedy': 'Greedy',
        'baseline greedy': 'Greedy',
        'Node-Features': 'Node-Features',  # 保持不变
    }
    
    # 转换去匿名化数据
    if 'deanonymization' in self.results:
        for item in self.results['deanonymization']:
            if 'method' in item and item['method'] in name_mapping:
                old_name = item['method']
                item['method'] = name_mapping[old_name]
                print(f"  Normalized: '{old_name}' -> '{item['method']}'")
    
    # 转换属性推断数据
    if 'attribute_inference' in self.results:
        for item in self.results['attribute_inference']:
            if 'method' in item and item['method'] in name_mapping:
                old_name = item['method']
                item['method'] = name_mapping[old_name]
                print(f"  Normalized: '{old_name}' -> '{item['method']}'")
```

### 2. 执行时机

自动转换在数据加载后立即执行：

```python
def __init__(self, results_file=None):
    # ... 加载JSON文件 ...
    
    # 自动转换方法名 ← 在这里执行
    self._normalize_method_names()
    
    # ... 后续处理 ...
```

---

## 📋 支持的转换

| 旧名称 | 新名称 | 状态 |
|--------|--------|------|
| `Baseline-Greedy` | `Greedy` | ✅ 自动转换 |
| `Baseline Greedy` | `Greedy` | ✅ 自动转换 |
| `baseline-greedy` | `Greedy` | ✅ 自动转换 |
| `baseline greedy` | `Greedy` | ✅ 自动转换 |
| `Node-Features` | `Node-Features` | ✅ 保持不变 |

---

## 🧪 测试结果

### 测试1：旧JSON文件（包含Baseline-Greedy）

```bash
cd /home/honglianglu/hdd/Anonymous
python visualize_unified_auto.py results/facebook_ego_ego0_20251229_221022.json
```

**输出**：
```
Normalized: 'Baseline-Greedy' -> 'Greedy'
Normalized: 'Node-Features' -> 'Node-Features'
Normalized: 'Baseline-Greedy' -> 'Greedy'
Normalized: 'Node-Features' -> 'Node-Features'
Normalized: 'Baseline-Greedy' -> 'Greedy'
Normalized: 'Node-Features' -> 'Node-Features'
Loading results: results/facebook_ego_ego0_20251229_221022.json
Dataset: facebook_ego
✅ Saved: facebook_ego_ego0_deanonymization.png
✅ Saved: facebook_ego_ego0_attack_heatmap.png
... (共8张图)
```

**结果**：✅ 所有图表中显示 "Greedy"，自动转换成功！

### 测试2：新JSON文件（已包含Greedy）

```bash
python visualize_unified_auto.py results/unified/cora_20251231_235254.json
```

**输出**：
```
Loading results: results/unified/cora_20251231_235254.json
Dataset: cora
✅ Saved: cora_deanonymization.png
... (共8张图)
```

**结果**：✅ 新文件不需要转换，直接处理成功！

---

## 🔍 转换日志

### 典型输出示例

```
Normalized: 'Baseline-Greedy' -> 'Greedy'  ← 温和匿名化
Normalized: 'Baseline-Greedy' -> 'Greedy'  ← 中等匿名化
Normalized: 'Baseline-Greedy' -> 'Greedy'  ← 较强匿名化
```

**说明**：
- 每个匿名化强度级别都会转换一次
- 转换是即时的，不修改原始JSON文件
- 只影响内存中的数据，用于图表生成

---

## ✅ 优势

### 1. 向后兼容性 ✅
- 旧的JSON文件仍可正常使用
- 无需手动修改历史数据
- 自动识别并转换

### 2. 统一命名 ✅
- 所有图表显示统一的方法名
- 新旧数据一致的视觉效果
- 避免命名混乱

### 3. 无侵入性 ✅
- 不修改原始JSON文件
- 只在可视化时转换
- 保持数据完整性

### 4. 可扩展性 ✅
- 映射表易于扩展
- 支持添加更多转换规则
- 灵活的命名策略

---

## 📂 影响范围

### 自动转换生效的位置：

1. ✅ **去匿名化图表**
   - 方法名显示
   - 图例标签
   - 热力图行标签
   - 方法排名图

2. ✅ **综合分析图**
   - 统计信息
   - 方法对比

3. ✅ **交互式HTML**（如果使用）
   - 方法列表
   - 图表标签

4. ✅ **文本报告**
   - 方法名称输出

---

## 🔧 如何添加新的转换规则

如需添加其他方法名转换，只需修改映射表：

```python
name_mapping = {
    'Baseline-Greedy': 'Greedy',
    'Baseline Greedy': 'Greedy',
    # 添加新规则
    'Old-Method-Name': 'New-Method-Name',
    'Another-Old-Name': 'New-Name',
}
```

---

## 📊 实际效果对比

### 转换前（旧JSON文件生成的图表）：
```
去匿名化方法：
┌─────────────────────┐
│ Baseline-Greedy     │  ← 旧名称
│ Hungarian           │
│ Node-Features       │
│ DeepWalk            │
└─────────────────────┘
```

### 转换后（使用自动转换功能）：
```
去匿名化方法：
┌─────────────────────┐
│ Greedy              │  ← ✅ 自动转换
│ Hungarian           │
│ Node-Features       │
│ DeepWalk            │
└─────────────────────┘
```

---

## 🎯 使用场景

### 场景1：处理旧数据

```bash
# 旧JSON包含 Baseline-Greedy
python visualize_all_unified.py

# 自动转换为 Greedy，无需任何操作
```

### 场景2：批量处理混合数据

```bash
# results/unified/ 包含新旧JSON
python visualize_all_unified.py

# 自动识别并统一命名
```

### 场景3：单独处理特定文件

```bash
# 处理旧文件
python visualize_unified_auto.py results/old_data.json

# 自动转换，生成统一风格的图表
```

---

## 📝 转换日志含义

**示例日志**：
```
Normalized: 'Baseline-Greedy' -> 'Greedy'
```

**含义**：
- `Normalized:` - 执行了标准化转换
- `'Baseline-Greedy'` - 原始方法名（从JSON读取）
- `->` - 转换箭头
- `'Greedy'` - 转换后的方法名（用于显示）

**出现位置**：
- 程序启动时
- 加载JSON后立即显示
- 每个转换的方法都会有一条日志

---

## ✅ 验证自动转换

### 方法1：检查转换日志

```bash
python visualize_unified_auto.py <json_file> 2>&1 | grep Normalized
```

**预期输出**：
```
Normalized: 'Baseline-Greedy' -> 'Greedy'
Normalized: 'Baseline-Greedy' -> 'Greedy'
...
```

### 方法2：查看生成的图表

打开任何去匿名化图表，检查方法名：
- ❌ 如果显示 `Baseline-Greedy` → 转换失败
- ✅ 如果显示 `Greedy` → 转换成功

### 方法3：检查图例

查看图表图例，确认：
- ✅ 圆角边框 + 阴影
- ✅ 方法名为 `Greedy`
- ✅ 无方框显示

---

## 🚀 总结

**功能状态**：✅ 已完成并测试

**关键特性**：
1. ✅ 自动识别旧方法名
2. ✅ 即时转换为新名称
3. ✅ 不修改原始数据
4. ✅ 完全向后兼容
5. ✅ 易于扩展

**使用方式**：
- 无需任何额外操作
- 照常运行可视化脚本
- 自动处理所有转换

**效果**：
- 所有图表统一显示 `Greedy`
- 新旧JSON文件一致的视觉效果
- 专业、清晰的图表呈现

---

**更新时间**: 2026-01-01 00:15  
**版本**: v3.2 - 自动方法名转换










